<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">-->
    <link rel="stylesheet" href="styles\styleTree.css">
    <!--<link rel="stylesheet" href="styles\style.css">-->
    <!--<link rel="stylesheet" href="styles\styleWG.css">-->
    
    <title>wherecaniwatch</title>
</head>

<body>
    <div class="container">

        <div class="background"></div>
        <div id="fireflies">
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
        </div>
        
        <div class="content">

            <div class="block">
                <h1 class="h1" style="font-size: 9vw">Where can I watch it?</h1>
            </div>

            <div class="block field is-grouped control" style="margin: 10px; display: flex; flex-wrap: flex; align-items: stretch; justify-content: flex-start; gap: 10px;">
                <input type="text" id="filmNameInput" placeholder="Enter movie name" class="input is-normal">

                <div class="dropdown" id="countrySelect">
                    <div class="dropdown-trigger">
                      <button class="button" aria-haspopup="true" aria-controls="dropdown-menu">
                        <span id="selectedCountry">United Kingdom</span>
                        <span class="icon is-small">
                          <i class="fas fa-angle-down" aria-hidden="true"></i>
                        </span>
                      </button>
                    </div>
                    <div class="dropdown-menu" id="dropdown-menu" role="menu">
                        <div class="dropdown-content">
                            <a href="#" class="dropdown-item" data-value="uk">United Kingdom</a>
                            <a href="#" class="dropdown-item" data-value="us">United States</a>
                            <a href="#" class="dropdown-item" data-value="ar">Argentina</a>
                            <a href="#" class="dropdown-item" data-value="at">Austria</a>
                            <a href="#" class="dropdown-item" data-value="be">Belgium</a>
                            <a href="#" class="dropdown-item" data-value="br">Brazil</a>
                            <a href="#" class="dropdown-item" data-value="ca">Canada</a>
                            <a href="#" class="dropdown-item" data-value="de">Germany</a>
                            <a href="#" class="dropdown-item" data-value="es">Spain</a>
                            <a href="#" class="dropdown-item" data-value="fr">France</a>
                            <a href="#" class="dropdown-item" data-value="ie">Ireland</a>
                            <a href="#" class="dropdown-item" data-value="id">Indonesia</a>
                            <a href="#" class="dropdown-item" data-value="it">Italy</a>
                            <a href="#" class="dropdown-item" data-value="is">Iceland</a>
                            <a href="#" class="dropdown-item" data-value="kr">South Korea</a>
                            <a href="#" class="dropdown-item" data-value="my">Malaysia</a>
                            <a href="#" class="dropdown-item" data-value="mx">Mexico</a>
                            <a href="#" class="dropdown-item" data-value="no">Norway</a>
                            <a href="#" class="dropdown-item" data-value="nl">Netherlands</a>
                            <a href="#" class="dropdown-item" data-value="pt">Portugal</a>
                            <a href="#" class="dropdown-item" data-value="se">Sweden</a>
                            <a href="#" class="dropdown-item" data-value="sg">Singapore</a>
                        </div>
                    </div>
                </div>
                  
                <button id="submit" class="button is-white">Search</button>
            </div>

            <div class="block">
                <!--<h2>Streaming Platforms:</h2>-->
                <ul id="results"></ul>
            </div>
    
        </div>
    </div>

    <script>
        async function getStreamingInfo(filmName, countryCode) {
            const response = await fetch('http://127.0.0.1:5000/get-streaming-info', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ film_name: filmName, country_code: countryCode })
            });

            if (response.ok) {
                const data = await response.json();
                const parsedData = parseData(data);
                displayResults(parsedData);
            } else {
                console.error('Error fetching streaming information');
            }
        }

        function parseData(data){
            const parsedData = []

            if (data != null){
                data.forEach(movie =>{
                    const movieData = {
                        name: movie.name,
                        locations: movie.locations.map(location => ({
                            display_name: location.display_name,
                            icon: location.icon,
                            url: location.url
                        }))
                        // , other interesting fields
                    };
                    parsedData.push(movieData);
                });
            };
            return parsedData;   
        }

        function displayResults(parsedData) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';  // Clear previous results

            parsedData.forEach(movie => {
                // Create the main card container
                const cardDiv = document.createElement('div');
                cardDiv.classList.add('card', 'mb-5');  // mb-5 adds margin below the card

                // Create the card content
                const cardContentDiv = document.createElement('div');
                cardContentDiv.classList.add('card-content');

                // Add the movie title
                const mediaDiv = document.createElement('div');
                mediaDiv.classList.add('media');

                const mediaContentDiv = document.createElement('div');
                mediaContentDiv.classList.add('media-content');

                const movieTitle = document.createElement('p');
                movieTitle.classList.add('title', 'is-4');
                movieTitle.textContent = movie.name;

                mediaContentDiv.appendChild(movieTitle);
                mediaDiv.appendChild(mediaContentDiv);
                cardContentDiv.appendChild(mediaDiv);

                // Add locations as a list
                const contentDiv = document.createElement('div');
                contentDiv.classList.add('content');

                movie.locations.forEach(location => {
                    const locationItem = document.createElement('p');

                    const locationLink = document.createElement('a');
                    locationLink.href = location.url;
                    locationLink.textContent = location.display_name;
                    locationLink.target = '_blank';

                    const locationIcon = document.createElement('img');
                    locationIcon.src = location.icon;
                    locationIcon.alt = location.display_name;
                    locationIcon.style.width = '24px';  // Set icon size
                    locationIcon.style.marginRight = '8px';  // Add some spacing

                    locationItem.appendChild(locationIcon);
                    locationItem.appendChild(locationLink);
                    contentDiv.appendChild(locationItem);
                });

                cardContentDiv.appendChild(contentDiv);
                cardDiv.appendChild(cardContentDiv);

                // Append the card to the results div
                resultsDiv.appendChild(cardDiv);
            });
        }


        document.getElementById('submit').addEventListener('click', () => {
            const filmName = document.getElementById('filmNameInput').value;
            const countryCode = document.getElementById('countrySelect').value;
            getStreamingInfo(filmName, countryCode);
        });

        document.addEventListener('DOMContentLoaded', () => {
        const dropdown = document.getElementById('countrySelect');
        const trigger = dropdown.querySelector('.dropdown-trigger');
        const items = dropdown.querySelectorAll('.dropdown-item');
        const selectedCountry = document.getElementById('selectedCountry');

        // Toggle dropdown
        trigger.addEventListener('click', () => {
            dropdown.classList.toggle('is-active');
        });

        // Handle dropdown item selection
        items.forEach(item => {
            item.addEventListener('click', (e) => {
            e.preventDefault();
            const value = item.getAttribute('data-value');
            const text = item.textContent;

            // Update the displayed text
            selectedCountry.textContent = text;

            // Close the dropdown
            dropdown.classList.remove('is-active');
            });
        });

        // Close dropdown if clicked outside
        document.addEventListener('click', function(event) {
            const isClickInside = dropdown.contains(event.target);
            if (!isClickInside) {
            dropdown.classList.remove('is-active');
            }
        });
        });

    </script>
</body>
</html>
